// -*- mode: adoc ; fill-column: 120 -*-
// ---- Beginn Standardheader
= RC MultiSwitch-D 
Wilhelm Meier <wilhelm.wm.meier@googlemail.com>
:revnumber: 1.07
:revremark: HW_1.2
:revdate: 01.01.1970
:lang: de
:toc:
:toc-title: Inhalt
:toclevels: 4
:numbered:
:pagenums:
:src_numbered: 
:icons: font
:icontype: svg
:figure-caption: Abbildung
:description: RC MultiSwitch-D
:title: RC MultiSwitch-D : ... und RC MultiAdapter-DA, RC ServoSwitch-D sowie TipTip
:title-page:
:sectanchors:
:sectlinks:
:experimental:
:copyright: Wilhelm Meier
:duration: 90
:source-highlighter: pygments
:pygments-css: class
:showtitle:
:docinfo1:
:stem:
// for attributes in link:[] macro like link:xxx[window="_blank"]
:linkattrs:

<<<

== Vorwort

image::by-nc-nd.eu.svg[align="center"]

.Lizenz
****
Dieses Werk ist unter einer Creative Commons Lizenz vom Typ Namensnennung - Nicht kommerziell - Keine Bearbeitungen 4.0 International zugänglich. Um eine Kopie dieser Lizenz einzusehen, konsultieren Sie http://creativecommons.org/licenses/by-nc-nd/4.0/ oder wenden Sie sich brieflich an Creative Commons, Postfach 1866, Mountain View, California, 94042, USA.
****

[NOTE]
Das Modul wie auch diese Doku ist noch unvollständig und _work-in-progess_. 
Bei jeglichen Unklarheiten in dieser Funktionsbeschreibung und generellem Aufbau und Anschluß, 
unterlassen Sie den Betrieb und kontaktieren Sie den Bausatzersteller.

<<<

== Symbolerklärung

[TIP]
Ein wichtiger allgemeiner Hinweis für den sicheren Aufbau und die sichere Bedienung. Dieser sollte durch den Anwender bachtet werden,
um einen sicheren Betrieb zu gewährleisten.

[NOTE]
Ein genereller Hinweis, der durch den Anwender beachtet werden sollte.

[IMPORTANT]
Ein technischer oder sicherheitstechnischer Hinweis, der unbedingt durch den Anwender beachtet werden muss.

[CAUTION]
Ein technischer oder sicherheitstechnischer Gefahrenhinweis, der unbedingt durch den Anwender beachtet werden muss. Zur 
Gefahrenabwendung muss der Anwender unbedingt die gegebenen Anweisungen befolgen und die beschriebenen Maßnahmen ergreifen.

== Rechtliches

Der vorliegende Bausatz wird dem Anwender für eigene Experimente überlassen. Er stellt kein Produkt im Sinne des ProdHaftG 
oder elektronisches Gerät im Sinne des ElektroG dar und wird als Gerät nicht kommerziell vertrieben. 

[IMPORTANT]
--
Die Überlassung gegen Unkostenerstattung erfolgt unter Ausschluss jeglicher Sach­mangelhaftung.

Für den vorliegenden Bausatz werden keine Funktionsgarantien gegeben. Für Schäden am Bausatz oder an damit verbundenen Geräten oder Modulen
wird keine Haftung übernommen. Gewährleistungen, Garantien und Widerrufsrechte gibt es nicht.
--

== Sicherheitshinweise

Beim Umgang mit Produkten, die mit elektrischer Spannung in Berührung kommen, müssen die gültigen VDE-Vorschriften beachtet werden, insbesondere 
VDE 0100, VDE 0550/0551, VDE 0700, VDE 0711 und VDE 0860.

Werkzeuge dürfen an Geräten, Bauteilen oder Baugruppen nur benutzt werden, wenn sichergestellt ist, dass die Geräte von der Versorgungsspannung 
getrennt sind und elektrische Ladungen, die in den im Gerät befindlichen Bauteilen gespeichert sind, vorher entladen wurden.

Spannungsführende Kabel oder Leitungen, mit denen das Gerät, das Bauteil oder die Baugruppe verbunden ist, müssen stets auf Isolationsfehler 
oder Bruchstellen untersucht werden. Bei Feststellen eines Fehlers in der Zuleitung muss das Gerät unverzüglich aus dem Betrieb genommen werden, 
bis die defekte Leitung ausgewechselt worden ist. Bei Einsatz von Bauelementen oder Baugruppen muss stets auf die strikte Einhaltung der in der 
zugehörigen Beschreibung genannten Kenndaten für elektrische Größen hingewiesen werden. Wenn aus einer vorliegenden Beschreibung für den nicht 
gewerblichen Endverbraucher nicht eindeutig hervorgeht, welche elektrischen Kennwerte für ein Bauteil oder eine Baugruppe gelten, wie eine 
externe Beschaltung durchzuführen ist oder welche externen Bauteile oder Zusatzgeräte angeschlossen werden dürfen und welche Anschlusswerte 
diese externen Komponenten haben dürfen, so muss stets ein Fachmann um Auskunft ersucht werden. Es ist vor der Inbetriebnahme eines Gerätes 
generell zu prüfen, ob dieses Gerät oder Baugruppe grundsätzlich für den Anwendungsfall, für den es verwendet werden soll, geeignet ist!

Im Zweifelsfalle sind unbedingt Rückfragen bei Fachleuten, Sachverständigen oder den Herstellern der verwendeten Baugruppen notwendig!

Bitte beachten Sie, dass Bedien- und Anschlussfehler außerhalb unseres Einflussbereiches liegen. Verständlicherweise können wir für Schäden, die 
daraus entstehen, keinerlei Haftung übernehmen. Bei Installationen und beim Umgang mit Netzspannung sind unbedingt die VDE-Vorschriften zu 
beachten. Geräte, die an einer Spannung über 35 V betrieben werden, dürfen nur vom Fachmann angeschlossen werden. In jedem Fall ist zu prüfen, 
ob der Bausatz oder die Platine für den jeweiligen Anwendungsfall und Einsatzort geeignet ist bzw. eingesetzt werden kann.

Derjenige, der eine Schaltung oder einen Bausatz aufbaut und fertigstellt oder eine Baugruppe durch Erweiterung bzw. Gehäuseeinbau 
betriebsbereit macht, gilt nach DIN VDE 0869 als Hersteller und ist verpflichtet, bei der Weitergabe des Gerätes alle Begleitpapiere 
mitzuliefern und auch seinen Namen und Anschrift anzugeben. Geräte, die aus Bausätzen selbst zusammengestellt werden, sind sicherheitstechnisch 
wie ein industrielles Produkt zu betrachten.

Für alle Personen- und Sachschäden, die aus nicht bestimmungsgemäßer Verwendung entstehen, ist nicht der Hersteller sondern der Betreiber 
verantwortlich. Bitte beachten Sie, das Bedien- und/und Anschlussfehler außerhalb unseres Einfußbereiches liegen. Verständlicherweise können wir 
für Schäden, die daraus entstehen, keinerlei Haftung übernehmen.

Jegliche Vorschriften und Vorsichtsmaßnahmen im Umgang mit elektrischen Komponenten sind vom Anwender einzuhalten.

Beachten Sie ebenfalls die Richtlinien unter <<Betrieb>>.

== Spezieller Sicherheitshinweis: Kleinteile

[CAUTION]
--
ACHTUNG: Der Bausatz enthält verschluckbare Kleinteile. Von Kindern fernhalten.
--

<<< 

== Einführung

Der `RC MultiSwitch-D` ist ein digitales Schaltmodul (8-Kanal) zum Betrieb mit einem `OpenTX`-Sender, vorzugsweise eine _Radiomaster_ `TX16s`
oder anderen sog. _color-LCD_ Sendern mit `OpenTX`.
Im Gegensatz zu alten, im analogen Zeitmultiplex-Verfahren arbeitenden Schaltmodulen, wird bei dem `RC MultiSwitch-D` die Information für die zu 
schaltenden Funktion vollständig digital übertragen. Daher ist ein störungsfreier Betrieb gewährleistet.

Der `RC MultiSwitch-D` hat 8 Ausgänge, diese können ein- oder ausgeschaltet werden, entweder statisch, oder in zwei unterschiedlichen Blink-Modi. Zusätzlich 
kann der _Ein_-Zustand `PWM`-moduliert werden (auch beim Blinken ist die `PWM`-Modulation aktiv). 
Die Konfiguration der Zustände erfolg komplett über den Sender und ein entsprechendes Menu.

Der `RC MultiSwitch-D` wird an den `IBus`- oder `SBus`-Ausgang eines Empfängers angeschlossen. Sollen mehrere `RC MultiSwitch-D` verwendet werden, so werden 
diese _alle_ (parallel) an den IBus/SBus-Ausgang des Empfängers angeschlossen. 
Jeder `RC MultiSwitch-D` hat eine eindeutige _Adresse_ und kann so vom Sender angesprochen werden.

Insgesamt können über _einen_ Übertragungskanal bis zu 8 `RC-MultiSwitch-D`, `RC-MultiAdapter-DA` oder `RC-ServoSwitch-D` und `RC-Quad-D` angeschlossen werden. 

=== Weitere Möglichkeiten

Nach dem gleichen Funktionsprinzip arbeitet der `RC MultiAdapter-DA`. Dieser ermöglocht den Betrieb alter, analoger 
Zeitmultiplex-Schaltmodule, die nach dem Verfahren von _Robbe_, oder _Graupner/JR_, oder _CP-Elektronik_ oder  _Beier NMS_ arbeiten. 
Der `RC MultiAdapter-DA` ermöglicht es, bis zu 5 analoge Zeitmultiplex-Schaltmodule anzuschließen. Dadurch bekommt jedes dieser 
analogen Schaltmodule über den Adapter ebenfalls eine _eindeutige_ Adresse, und kann vom Sender angesprochen werden. 
Eine PWM-Modulation der Ausgänge eines analogen Zeitmultiplex-Schaltmoduls ist allerdings nicht möglich.

Analoge Zeitmultiplex-Schaltmodule der Fa. _Robbe_ besitzen neben den 6 Schaltfunktionen (12 Ausgänge) auch noch 2 proportionale Ausgänge. Mit 
Hilfe des `RC MultiAdapter-DA` können zwei beliebige `OpenTX`-Kanäle den beiden proportionalen Ausgängen des _Robbe_-Modules zugewiesen werden. 
Auch gibt es von der Fa. _Robbe_ ein 8-Kanal Multi-Prop Modul, was ebenfalls angesteuert werden kann.

Das Modul `RC-ServoSwitch-D` ist eine Ansteuerung für bis zu 5 Servos. Diese Servos können bis zu 8 Positionen annehmen. Diese Positionen sind den 
Schalterstellungen bzw. den Menu-Buttons zugeordnet. Statt Verbraucher ein/aus zu schalten, fahren die Servos bestimmte, vorher erlernte Positionen an. Die 
Geschwindigkeit, mit der sich die Servos bewegen, kann ebenfalls eingestellt werden. Auch können zwei oder mehrere Servos dieselben Bewegungen ausführen.

Weiterhin kann die Software für `OpenTX` auch direkt Schaltmodule im sog. _TipTip_ Verfahren bedienen. Hierzu ist im Moment kein Adapter 
`RC MultiAdapter-DA` notwendig. Stattdessen müssen die _TipTip_-Module wie üblich jeweils an einem eigenen Ausgang des Empfängers angeschlossen werden.
Durch die Zusatzfunktionen ist das Bedienen (inkl. Beschriftung der Funktionen und Zustände) wie auch bei allen anderen Varianten (`RC MultiSwitch-D` 
und `RC MultiAdapter-DA`) komfortabel über das Menu im Sender möglich.

=== Grundsätzliches

==== Bedienung

Die Bedienung der Schaltmodule erfolgt grundsätzlich über ein _Menu_. Dieses ist als _Widget_ in `OpenTx` realisiert. 

In <<menu1>> sieht man eine Seite (oben rechts: `Page: 1/4`) des Menus. Diese Seite ist für die Bedienung eines `RC MultiSwitch-D` konfiguriert: 
in der ersten Spalte stehen die _Namen_ der Funktionen (hier: `Fun A` ... `Fun H`) für die 8 Ausgänge des Schaltmoduls. Diese Namen können 
in der Konfigurationsdatei (s.a. <<config>>) frei gewählt werden. Damit _entfällt_ das Problem einer _Schalterbeschriftung_, was man von früher her kennt.

In den weiteren Spalten stehen die verschiedenen _Zustände_, die eine Schaltfunktion annehmen kann. Jeder Zustand kann durch eine _Selektion_ 
aktiviert werden.

[[menu1]]
.Die Bedienoberfläche als Widget (Seite 1) 
image::wmsw2.png[align="center"]

Sollte eine Schaltfunktion auch ein _ShortCut_ in Form eines physischen Schalters (3-Positionenschalter) zugeordnet haben, so erscheint der _Name_
des Schalters zusätzlich hinter dem Namen der Funktion. In der ersten Zeile bedeutet `Fun A/sa`, dass der Funktion `Fun A` zusätzlich der _ShortCut_ 
Schalter `sa` zugeordent wurde. Dies geschieht auch in der Konfigurationsdatei. Mit einem 3-Positionenschalter sind natürlich nur die ersten _drei_
Zustände `aus`, `ein` und `blink1` erreichbar.

Im Bild <<menu2>> sieht man dann die nä. Seite mit den Funktionen des nä. Schaltmoduls. Hier sind die Menu-Seiten entsprechend 
der Platzierung der Funktionen auf den Schaltmodulen strukturiert. Das muss aber so nicht sein: man kann auch Funktionen unterschiedlicher 
Module eher _thematisch_ auf einer Menu-Seite zusammen fassen.

[[menu2]]
.Die Bedienoberfläche als Widget (Seite 2)
image::wmsw.png[align="center"]

Die _vierte_ Seite dieses Beispiels stellt das Menu für ein `RC MultiAdapter-DA` dar. Hier hat jede Funktion nur _drei_ Zustände. Die beiden 
`Ein`-Zustände entsprechen bei den üblichen analogen Zeitmultiplex-Schaltmodulen jeweils zwei unterschiedlichen Ausgängen. Natürlich können auch hier die 
Namen geändert werden.

[[menu3]]
.Die Bedienoberfläche als Widget (Seite 4)
image::wmsw3.png[align="center"]

Weil die Anzahl der phys. Schalter am Sender naturgemäß begrenzt ist (etwa: `sa`, ... `sh`), kann man nicht für alle Funktionen _ShortCuts_ 
über Schalter definieren. Eine Abhilfe bieten die sog. _Overlays_. Dies ist bei den analogen Schaltmodulen als _Ebenenumschaltung_ bekannt. 
Wird ein phys. Schalter für _mehr_ als eine Funktion definiert, so wird er _automatisch_ zu einem _Overlay_. Dies bedeutet, dass die 
Zuordnung des Schalters zu einer Funktion von der gerade sichtbaren Menu-Seite abhängig ist (Analogie: Menu-Seite = Ebene).

Zusammen mit dem schnellen Umschalten zwischen Menu-Seite mit Hilfe des 6-Positionen-Tasters `6pos` bei manchen Sendern (etwa: _Radiomaster_ `TX16s`)
ergibt sich eine sehr komfortable Bedienung.

==== Konfiguration

Die Konfiguration wichtiger _Parameter_ der Schaltfunktionen erfolgt ebenfalls über ein Menu-System. Dies ist als eigenes Widget realisiert. 

Im Bild <<menuc1>> sind zu jeder Funktion die konfigurierbaren _Parameter_ aufgelistet. Zudem besteht die Möglichkeit, ein _Reset_ durchzuführen.

Soll ein Parameter konfiguriert werden, so muss er _selektiert_ werden und sein _Wert_ wird dann anschließend über das Potentiometer `S1` eingestellt. 
Der Wert wird _oben rechts_ im Menu in `%` und auf einer Skala von `0` ... `31` angezeigt. 

[[menuc1]]
.Die Konfigurationsoberfläche als Widget (Funktionsspezifische Parameter)
image::wmswc.png[align="center"]

Zusätzlich zu den _funktionsspezifischen_ Parametern für jedes Schaltmodul (Achtung: nicht jedes Schaltmodul kann alle Parameter ausführen), 
existiert noch eine _weitere_ Menu-Seite für modul-spezifische (für ein Modul als Ganzes) Parameter (s.a. <<menuc2>>). 

Dies betrifft vor allem das Anlernen der Modul-Adresse, wobei dies aus Sicherheitsgründen nur beim _Einschalten_ des Moduls möglich ist (s.a. <<learn>>).

Die Parameter `MPX0` ... `MPX4` beziehen sich _nur_ auf das `RC MultiAdapter-DA`: hiermit kann die _Art_ des am jeweiligen Ausgangs `0` ... `4` 
angeschlossenen analogen Zeitmultiplex-Schaltmodul festgelegt werden (Wert `1` := Graupner/JR, Wert `2` := Robbe, Wert `3` := CP).

[[menuc2]]
.Die Konfigurationsoberfläche als Widget (modulglobale Parameter)
image::wmswc2.png[align="center"]

Da dieses Widget zum eigentlichen Betrieb _nicht_ erforderlich ist, kann es _nach_ der Konfiguration deaktiviert werden bzw. durch andere 
Widgets ersetzt werden.

== Software für OpenTX

Für den Betrieb und zur Konfiguration des `RCMultiSwitch-D` und `RC MultiAdapter-DA`  sind einige Scripte und Konfigurationsdatein notwendig.
Diese findet man in der aktuellesten Version jeweils auf https://github.com/wimalopaan/opentx[GitHub].

.Lizenz der Software, des Übertragungsverfahrens und der Dokumentation
[IMPORTANT]
--
image:by-nc-nd.eu.svg[]
Bitte beachten Sie, dass neben dieser Dokumentation auch die https://github.com/wimalopaan/opentx[Software] und das Übertragungsverfahren als Konzept der einer Lizenz (Nutzungsvereinbarung) unterliegt. Die genauen Bedingungen dieser Lizenz finden Sie https://creativecommons.org/licenses/by-nc-nd/4.0/deed.de[hier].
--

Für den `RC MultiSwitch-D` und `RC MultiAdapter-DA` sind die folgenden relevant:

* Widgets
** `Widgets/WMSW/main.lua`
** `Widgets/WMSWC/main.lua`

* Mixer-Scripte
** `MIXES/encib.lua`
** `MIXES/encsbm.lua` (für Anlagen mit MPM-HF-Modul)
** `MIXES/encxjt.lua` (für Anlagen mit internem XJT-HF-Modul)
** `MIXES/encsb.lua` (nur zu Testzwecken)

* Telemetrie-Scripte (für monochrome Sender)
** `SCRIPTS/TELEMETRY/wmsw.lua`
** `SCRIPTS/TELEMETRY/wmswc.lua`

* Bibliotheken
** `SCRIPTS/CONFIG/wmcfg.lua`
** `SCRIPTS/WM/wmlib.lua`

* Konfiguration
** `MODELS/swstd.lua` (Standardkonfiguration für Anlagen mit großem Display)
** `MODELS/swstdm.lua` (Standardkonfiguration für Anlagen mit mittlerem Display)
** `MODELS/swstds.lua` (Standardkonfiguration für Anlagen mit kleinem Display)
** `MODELS/swstdx.lua` (Standardkonfiguration für Anlagen mit kleinem Display und wenigen Modulen)
** `MODELS/<name>.lua` (modellspezifische Konfigurationen)(z.B. `Abc.lua` für das Model mit dem Namen `Abc`)

=== Installation der Software auf dem Sender

Kopieren Sie die o.g. Dateien in _korrespondierende_ (gleichlautende) Verzeichnisse auf der SD-Karte des Senders. 

[TIP]
--
Die Datei `MODELS/swstd.lua` sollte unangetastet bleiben (als _fallback_). Stattdessen kopieren Sie diese Datei in 
für jedes Modell jeweils eigene Dateien. Dann ist für das Modell mit dem Namen `ABC` der _Dateiname_ `ABC.lua`. 

Kommen weitere Modelle hinzu, so wiederholen Sie diesen Schritt für _jedes_ Modell.

Anschließend kann der _Datei-Inhalt_ mit einem normalen Texteditor (etwa `NotePad`) editiert werden.
--

Die beachten Sie auch die Unterscheidung zwischen `Sbus` und `IBus`.

==== Unterscheidung der verschiedenen Sendermodelle

Grundsätzlich unterscheiden sich die Sender mit den `480x272`-Pixel großen _Farbdisplay_ von den Sendern mit 
den `128x64`-Pixel oder `212x64`-Pixel großen _monochromen_ Displays von einander: 

* Typ-1: `128x64`-Pixel oder `212x64`-Pixel großes _monochromes_ Display
* Typ-2: `480x272`-Pixel großen _Farbdisplay_ (auch _Touchdisplay_)

Bei _Typ-1_ Sendern existieren im Menu-System keine sog. _Widgets_ sondern nur _Telemetrie_-Seiten. Auf der 
anderen Seite existieren bei den _Typ-2_ Sendern keine _Telemetrie_-Seiten sondern wiederum nur _Widgets_. Dies 
macht eine Unterscheidung bei den Skripten für die Schaltmodule notwendig.

Zudem sind die _Typ-1_ Sender im verfügbaren `RAM` sehr _eingeschränkt_. Daher kann hier oft das 
Telemetrie-Skript zur _Bedienung_ und das Telemetrie-Skript zur _Konfiguration_ nicht gleichzeitig 
geladen werden. Es kommt in diesem Fall zu einer _Fehlermeldung_ des Senders. Man kann sich in so einem Fall behelfen, 
indem man die (nicht so häufige) Konfiguration und die (häufigere) Bedienung abwechselnd auf _eine_ Telemetrie-Seite legt.

=== Konfiguration des Modells (Sender mit `480x272`-Pixel _Farbdisplay_)

Die folgenden Einstallungen gelten _nur_ für Sender mit `480x272`-Pixel _Farbdisplay_.

==== Widget für die Bedienung

Richten Sie eine Telemetrie-Seite (volle Größe) ein mit dem Widget `Widgets/WMSW/main.lua`. Dieses stellt sich als `Wm MultiSwitch x.y` dar.

==== Widget für die Konfiguration

Richten Sie eine Telemetrie-Seite (volle Größe) ein mit dem Widget `Widgets/WMSWC/main.lua`. Dieses stellt sich als `Wm MultiKanal Config x.y` dar.

[[mixes]]
==== Mixer-Script

Richten Sie ein `LUA`-Script ein. Hier wählen Sie _nur eines_ der Auswahl aus:

* `encib` für `IBus`-Empfänger
* `encsbm` für `SBus`-Empfänger und Sender mit MPM-Multiprotokoll-HF-Modul
* `encxjt` für `SBus`-Empfänger und Sender mit XJT-HF-Modul

[[channels]]
==== Definition eines Übertragungskanals für das Schaltmodul am Empfänger

Das Schaltmodul wird über eine serielle Schnittstelle an den Empfänger angeschlossen. Dies ist je nach Empfänger `IBus` oder `SBus`.

Das Schaltmodul ist standardmäßig auf Kanal `10` eingestellt. Es kann jedoch auch ein anderer Kanal angelernt werden (s.a. <<learn>>).

Im Sender muss daher für diesen Kanal als Quelle das entspechende Mixer-Script eingetragen werden.

// todo: encsbm.lua
.Das Mischer-Skript `encsbm.lua` 
image::m1a.png[align="center"]

// todo: encsbm.lua
.Hier wird der Übertragungskanal `10` wird für die Schaltmodule verwendet.
image::m2a.png[align="center"]

// todo: encsbm.lua
.Als Quelle des Mischers des Übertragungskanals wird das Mischer-Skript `encsbm.lua` eingetragen
image::m3a.png[align="center"]

.Mögliche Fehlerquelle im späteren Betrieb
[CAUTION]
--
Bei _jedem_ Einschalten scannen die Schaltmodule _alle_ Übertragungskanäle auf ein spezielles Konfigurationssignal,
um den Übertragungskanal zu finden und ggf. die Adresse des Moduls neu zu lernen. Dieses Konfigurationssignal kann auch 
durch zufällige Geberposition auf anderen Kanälen unbeabsichtigt entstehen. Um dieses Problem zu umgehen, sollten
die Übertragungskanäle mit Nummern _oberhalb_ des gewählten Kanals für die digitalen Schaltmodule _unbenutzt_ sein. 
Um auch bei späteren Erweiterung von Modellen hier vor Fehlern geschützt zu sein, sollte sich der Übertragungskanal für die 
digitalen Schaltmodule auf der _höchsten_ Kanalnummer befinden. Dies ist bei `SBus` der Kanal `16` und bei `IBus` 
der Kanal `14` oder `16` (je nach verwendeter Version der Firmware im _4in1-MPM-HF-Modul_).
--

==== Definition der Geber (Inputs)

.Bedienelemente für die Widgets
[TIP]
--
Die Widgets müssen mit Bedienelementen des Senders bedient werden können (Scroll, Select). 

In `OpenTX`-Version < `2.4.0` kann dies nur durch _normale_ Bedienelemente (Geber) erfolgen. Dazu sind einige Definitionen nötig.
--

Definieren Sie die folgenden, in den Widgets voreingestellten _Inputs_ nach dem Muster aus <<inputs>>:

* I8 : Navigation von links nach rechts (und vom Zeilenende in den Zeilenanfang der nächsten Zeile)
* I9 : Navigation von rechts nach linkes (und vom Zeilenanfang in das Zeilenende der vorherigen Zeile)
* I10 : Selektion
* (I11) : Navigation nach oben (in Standardeinstellung unbenutzt)
* (I12) : Navigation nach unten (in Standardeinstellung unbenutzt)

(Lassen die die _unbenutzten_ Inputs in ihrem Modell frei. Andernfalls sind Fehlfunktionen nicht ausgeschlossen.)

Möchten Sie andere Geber-Nummern verwenden, so ist dies auch möglich. Die Gebernummern müssen dann in der entsprechenden _Widget_-Konfiguration 
definiert werden. Dies ist dann für beide Widgets gleichmaßen notwendig.

[[inputs]]
.Benötigte Geber zur Bedienung der Widgets (Darstellung im Companion)
image::inputs.png[align="center"]

.Benötigte Geber (Darstellung im Sender)
image::in1.png[align="center"]

.Benötigte Geber (Darstellung im Sender)
image::in2.png[align="center"]

.Benötigte Geber (Darstellung im Sender)
image::in3.png[align="center"]

Um die Bedienung weiter zu vereinfachen, werden standardmäßig weitere Bedienelemente für die Widgets verwendet. Diese sind voreingestellt.
Sie können aber in der Datei `MODELS/swstd.lua` bzw. der modellspezifischen Datein `MODELS/<name>.lua` geändert werden. 

.SpeedDial mit den Gebern `LS` und `RS`
[TIP]
--
Bei Sendern mit den beiden Schiebern `LS` und `RS` sind diese für die direkte Anwahl von Menu-Punkten im Normalfall eingerichtet.
--

.Menu-Schnellanwahl mit dem 6-Positionentaster `6pos` (_Krähenfüße_)
[TIP]
--
Der 6-Positionentaster `6pos` ist standardmäßig als _Schnellwahl_ für die ersten sechs Menuseiten (Schaltmodule) konfiguriert. Dies ist besondes 
interessant mit der Möglichkeit der _Overlays_ (Ebenenumschaltung).
--

.Parameterwerte einstellen mit Potentiometer `S1`
[NOTE]
--
Im Widget für die _Konfiguration_ des `RC MultiSwitch-D` kann/muss man einige Parameter einstellen wie etwa die Blinkfrequenz oder die Einschaltdauer für den 
Schaltzustand `blink1` oder `blink2`. Wenn dieser Parameter im Menu angewählt ist, kann man den Wert diekt über das Poti `S1` einstellen. Dies wird dann 
auch im Menu als Wert (oben rechts) angezeigt. Die aktive Selektion wird durch eine _Invers_-Darstellung der Werte oben rechts im Menu kenntlich gemacht.
--

==== Flugphasen

Damit die (oft unbenutzten) zusätzlichen Trimm-Taster für die Bedienung der Widgets benutzt werden können, müssen Sie als Trimm-Funktion deaktiviert werden. 
Die geschieht in der entsprechenden _Flugphase_, in der die Bedienung der Widgets möglich sein soll. Also am besten in allen Flugphasen bzw. in der 
Flugphase `0`.

[[flugph]]
.Deaktivierung der Trimmer `T5` und `T6` in der Flugphase `0` (Darstellung im Companion)
image::fp.png[align="center"]

.Deaktivierung der Trimmer `T5` und `T6` in der Flugphase `0` (Darstellung im Sender)
image::fm1.png[align="center"]

==== Spezielle Konfiguration für Sender mit Joystick (FrSky X12s)

Der Sender _FrSky Horus X12s_ besitzt ein besonderes Bedienelement: den _Joystick_ links unten. Dieser kann statt der o.g. Trimm-Buttons ebenfalls für die 
Navigation im Menu-System der Schaltmodule verwendet werden. Da es sich dabei um proportionale Geber handelt, muss mit Hilfe eine Kurve (Sprungfunktion) aus der 
proportionalen Informations des Gebers eine digitale gemacht werden.

[CAUTION]
--
Wird die hier beschriebene Konfiguration ausgeführt, so sollten die Geber `Jsx` und `Jsy` nicht mehr als _normale_ Geber verwendet werden, da sie in jedem Fall den _Cursor_ 
der Widgets beinflussen. 
--

Es muss dazu _eine_ Kurve nach dem Muster <<curve1>> erstellt werden. Diese Kurve kann für beide Richtungen (positive und negative Richtung) jeder Achse 
des Joysticks verwendet werden. Die _Spiegelung_ der Kurve geschieht durch eine _Negation_ (das _Ausrufezeichen_ `!` in der Input-Konfiguration). Getreu nach der Regel, dass
_Unzulänglichkeiten_ der Geber in der Input-Konfiguration _korrigiert_ werden, geschieht dies durch _vier_ Input-Definitionen aus den 
zwei Gebern `Jsx` und `Jsy` für die Navigation `rechts`, `links`, `oben` und `unten`.

[[curve1]]
.Kurve zur Umwandlung einer JoyStick-Bewegung in eine Navigation
image::joystick/curveJoy2.png[align="center"]

In <<curve2>> sieht man die Verwendung der Kurve in _einem_ Input.

[[curve2]]
.Verwendung der Kurve aus <<curve1>> für den Joystick in y-Richtung
image::joystick/curveJoy.png[align="center"]

In <<curve3>> sieht man den Überblick über die gesamte Konfiguration aller _vier_ Inputs. Man achte auf die _Spiegelung_ der Kurve durch `!`.

[[curve3]]
.Konfiguration der alternativen Inputs 11...14 für die Bedienung
image::joystick/inputsJoy2.png[align="center"]

Der letzte Schritt besteht im _Einbau_ der Inputs in die Widget-Konfiguration: 

[[curve4]]
.Konfiguration des Widget zur Verwendung der alternativen Inputs
image::joystick/widgetJoy2.png[align="center"]

Diese Konfiguration kann sowohl für das _Bedienungswidget_ `wmsw` wie auch für das _Konfigurationswidget_ `wmswc` durchgeführt werden.


=== Konfiguration des Modells (Sender mit `128x64`-Pixel oder `212x54`-Pixel _monochrome Display_)

Die folgenden Einstellungen gelten nur für Sender mit `128x64`-Pixel oder `212x54`-Pixel _monochromem Display_.

==== Telemetrie-Seiten

Richten Sie je eine Telemetrie-Seite mit dem Skript `SCRIPTS/TELEMETRY/wmsw.lua` bzw.
`SCRIPTS/TELEMETRY/wmswc.lua` ein.

[CAUTION]
Diese Sender haben sehr wenig RAM. Der Betrieb von _beiden_ o.g. Scripten _gleichzeitig_ ist oft nicht möglich und 
kann zu unterschiedlichen Fehlermeldungen führen. Sollte das passieren, so können Sie eintweder nur das eine _oder_ 
das andere Script einstellen. Die Einschränkung ist nicht so groß, da man das Konfigurationsscript ja nur 
selten (in der Werkstatt) benötigt.

==== Mixer-Script und Übertragungskanal

Für die Einrichtung des passenden _Mixer_-Scripts und _Übertragungskanals_ folgende sie bitte 
<<mixes>> bzw. <<channels>>.

==== Geber und Flugphasen

Die _Bedienung_ der Skripte erfolgt _vollständig_ über die normalen Bedienelemente für die 
Benutzerschnittstelle: Navigationstasten bzw. Navigationsrad. Daher ist eine Konfiguration von 
speziellen Gebern und Flugphasen nicht notwendig.

=== Konfigurationsdateien

[[config]]
==== Die Datei `MODELS/swstd.lua` und weitere Dateien

In dem Ordner `MODELS` des SD-Karte werden modellspezifische Menu-Konfigurationen abgelegt.

Dabei gilt folgende Suchreihenfolge für ein Model mit dem Namen `ABC`:

. `MODELS/ABC.lua`
. `MODELS/swstd.lua` (bzw. `MODELS/swstdx.lua` für kleine Sender)

Sinnvollerweise kopiert man die Datei `swstd.lua` in eine Datei `ABC.lua` für das Model `ABC` und editiert diese entsprechend 
den eigenen Wünschen.

In der Datenstruktur `menu` können an folgenden Elementen Veränderungen vorgenommen werden:

* Namen der Funktionen (`menu.pages.items.name`)
* Namen der Zustände (`menu.pages.items.states`)
* Namen der phys. Schalter (`menu.pages.items.data.switch`)
* Adresse des Moduls (`menu.pages.items.data.module`)

.Unterscheidung zwischen `SBus` und `IBus`
[NOTE]
--
Leider muss durch die Beschränkungen des `SBus`-Protokolls noch an einer zweiten Stelle ein Änderung vorgenommen werden. Damit die folgende Änderung 
jeweils für ein bestimmtes Modell gültig ist, sollte sie auch in der modellspezifischen Datei bspw. `ABC.lua` vorgenommen werden:

* Für `SBus`: der Parameter `useSbus = 1`
* Für `IBus`, etc.: der Parameter `useSbus = 0`

Achten Sie ebenfalls darauf, dass Sie das _dazu passende_ Mixer-Script `encsbm.lua`, `encxjt.lua` oder `encib.lua` eingerichtet haben (s.a. <<mixes>>).

Diese Beschränkungen haben zur Folge, dass nur 16 verschieden Parameterwerte (etwa für den PWM-Wert oder das Blink-Intervall) eingestellt werden können.

Am _unteren, rechten_ Rand des Widgets wird angezeigt, ob eine `SBus` oder `IBus` Konfiguration aktiv ist (zur Kontrolle).
--

.Ausschnitt A (aus der Datei `swstd.lua`, `swstdm.lua`, ...)
[source,lua,linenums]
----
local name = "Default";

local gVariable = 5;

local useSbus = 1; -- only 4 states, only 16 parameter values <1>

local gstates1 = {"aus", "ein", "blink1", "blink2"}; -- <1>
local gstates2 = {"aus", "ein 1", "ein 2"};
local gstates3 = {"Pos1", "Pos2", "Pos3", "Pos4", "Pos5"};

local menu = {
  title = "WM MultiSwitch",

  scrollUpDn = "ls", -- direct navigating
  scrollLR = "rs",

  parameterDial = "s1",
  
  pageSwitch = "6pos";

  remote = "trn16";

  state = {
    activeRow = 1,
    activeCol = 1,
    activePage = nil
  },
  pages = {
    { -- template for digital multiswitch RC-MultiSwitch-D @ Address(1) 
      items = { -- <2>
        {name = "M1A", states = gstates1, state = 1, data = {switch = "sa", count = 1, module = 1}}, -- <3>
        {name = "M1B", states = gstates1, state = 1, data = {switch = "sb", count = 2, module = 1}},
        {name = "M1C", states = gstates1, state = 1, data = {switch = nil, count = 3, module = 1}},
        {name = "M1D", states = gstates1, state = 1, data = {switch = "se", count = 4, module = 1}}, -- <5>
        {name = "M1E", states = gstates1, state = 1, data = {switch = nil, count = 5, module = 1}},
        {name = "M1F", states = gstates1, state = 1, data = {switch = nil, count = 6, module = 1}},
        {name = "M1G", states = gstates1, state = 1, data = {switch = nil, count = 7, module = 1}},
        {name = "M1H", states = gstates1, state = 1, data = {switch = nil, count = 8, module = 1}},
      }
    },
    { -- template for digital multiswitch RC-MultiSwitch-D @ Address(2)
      items = { -- <4>
        {name = "M2A", states = gstates1, state = 1, data = {switch = "sc", count = 1, module = 2}},
        {name = "M2B", states = gstates1, state = 1, data = {switch = "sd", count = 2, module = 2}},
        {name = "M2C", states = gstates1, state = 1, data = {switch = nil, count = 3, module = 2}},
        {name = "M2D", states = gstates1, state = 1, data = {switch = "se", count = 4, module = 2}}, -- <6>
        {name = "M2E", states = gstates1, state = 1, data = {switch = nil, count = 5, module = 2}},
        {name = "M2F", states = gstates1, state = 1, data = {switch = nil, count = 6, module = 2}},
        {name = "M2G", states = gstates1, state = 1, data = {switch = nil, count = 7, module = 2}},
        {name = "M2H", states = gstates1, state = 1, data = {switch = nil, count = 8, module = 2}},
      }
    },
    ...
};
...
----
<1> Diese Namen für die Schaltzustände können frei gewählt werden.
<2> Dies ist die Konfiguration für das Module mit der Adresse `1` (s.a. `module = 1`) auf der Seite `1` des Menus (der _erste_ `items` Block).
<3> Den Namen der Funktione (`name = "M1A"`) können Sie beliebig ändern.
<4> Dies ist die Konfiguration für das Module mit der Adresse `1` (s.a. `module = 2`)
<5> Diese Funktion hat einen Schalter zugeordnet (`switch = "se"`).
<6> Diese Funktion hat einen Schalter zugeordnet (`switch = "se"`). Da es derselbe Schalter ist, der schon für eine Funktion auf der Seite `1` verwendet wurde, ist dies 
ein sog. _Overlay_ (im Menu dann besonders gekennzeichnet)

Wird ein phys. Schalter _einer_ Schaltfunktion zugeordnet, dann kann diese Funktion _immer_ mit diesem Schalter bedient werden. Der Schalter ist dann 
ein _ShortCut_ (Abkürzung).

Wird ein phys. Schalter _mehr als einer_ Schaltfunktion zugeordnet, dann wird dieser Schalter _automatisch_ zu einem _Overlay_. Dies wird dann im Menu durch 
ein `!` hinter dem Namen des Schalters dargestellt. Damit wirkt der Schalter dann _nur_ auf die zugeordnete Funktion der _altiven_ Menu-Seite (sichtbar).

.ShortCuts (Abkürzungen)
[CAUTION]
Die physichen Schalter steller gewissermaßen _ShortCuts_ (Abkürzungen) für die Bedienung des Menus dar. Deswegen darf _ein_ Schalter auch nur 
_einer_ Funktion in der _gesamten_ Menu-Konfiguration zugeordnet werden. Das bedeutet, dass bspw. der Schalter `sa` immer auf die Funktion `Fun3` des 
Moduls `1` wirkt, und zwar unabhängig, welches Menu gerade angezeigt wird (etwa das Menu vom Modul `2`). 

.Overlays (Ebenen)
[TIP]
--
Manchmal ist es wünschenswert, dass ein phys. Schalter nicht _immer_ auf _dieselbe_ Funktion wirkt, sondern dass man:

. zwischen den Menus der angeschlossenen Schaltmodule wählen kann (Ebenenumschaltung), und dann
. ein phys. Schalter abhängig von dem so gewählten Schaltmodul eine andere Bedeutung bekommt.

Das bedeutet, dass bspw. der Schalter `sa` bei aktivem Menu des Moduls `1` auf dessen Funktion `Fun3` wirkt, bei aktivem Menu des Moduls `2` aber auf die 
Funktion `Fun3` des Moduls `2`.

Einige Modellbauer werden diese Funktion als _Ebenenumschaltung_ kennen. Bei analogen Schaltmodulen hat man eine Ebenenumschaltung dadurch realisiert, dann
man mit einem Schalter und Mischern etwa den Ausgangskanal für das Zeitmultiplexsignal umgeschaltet hat, um mehrere analoge Schaltmodule zu erreichen. Damit 
wurden die Schaltmodule _als Ganzes_ umgeschaltet. Bei `RC MultiSwitch-D` ist dies flexibler bezogen auf individuelle Schalter möglich.
--

.Menuseiten und Schaltmodule
[TIP]
--
Die Menu-Seiten mit jeweils 8 Zeilen müssen _nicht_ immer der Zuordnung zu den phys. Schaltmodulen entsprechen: auf einer Menu-Seite können 
Funktionen _unterschiedlicher_ Schaltmodule untergebracht werden. Denn jedes Modul hat eine _Adresse_, und diese Adresse ist Bestandteil der Funktionsdefinition
in der Datei. Man kann also die Menu-Seiten auch eher nach Funktionsgruppen strukturieren als nach Schaltmodulen.
--

==== Das Widget `WMSW/main.lua`

In dieser Datei sind üblicherweise keine Änderungen notwendig.

Dieses Widget ist die _Zentrale_ zur Bedienung aller Schaltfunktionen in allen Schaltmodulen. Am Beispiel der Datei `swstd.lua` sieht man 
eine Gliederung der Funktionen in Gruppen zu je 8 Funktionen, die sich auf einem `RC MultiSwitch-D` befinden. Für jeden Ausgang des `RC MultiSwitch-D` 
können dann die unterschiedlichen Zustände ausgewählt werden.

Die Anwahl der Funktion und des Zustandes erfolgt mit `T5`-hoch und -herunter, die Selektion erfolgt mit `T6`-hoch. 

Um auf die nächte Seite (für das nä. Schaltmodul `RC MultiSwitch-D`) gelangen, navigiert man mit `T5`-herunter bis unter die letzte Zeile, oder mit 
`T5`-hoch bis vor die erste Zeile des aktuellen Menus. Damit wird auf die anderen Menuseiten (andere `RC MultiSwitch-D`) umgeschaltet.

Alternativ kann mit dem 6-Positionentaster `6pos` umgeschaltet werden.

Zusätzlich stehen `LS` zu schnellen Auswahl der Menuzeile und `RS` für die Spalte zur Verfügung.

==== Das Widget `WMSWC/main.lua` (Konfiguration)

In dieser Datei sind üblicherweise keine Änderungen notwendig.

Dieses Widget dient zur _Konfiguration_ aller Parameter jeder Funktion wie dem _Anlernen_ von Übertragungskanal sowie der Adresse eines Moduls

Die einzelnen Parameter des Menus lassen die _nur_ mit `T5`-hoch und -herunter anwählen sowie `T6`-hoch selektieren. _Nach_ der Selektion wird das 
Potentiometer `S1` zum Einstellen des Parameterwertes:

* `RES`: Reset aller Werte der Funktion (Wert _muss_ auf `1` stehen, damit de Reset ausgeführt wird)
* `PWN`: Einstellen der PWM-Modulation, kann direkt an der _Helligkeit_ der Kontroll-LED beobachtet werden. Beim `RC-ServoSwitch-D` wird hier die _Geschwindigkeit_ 
eingestellt (1=langsam, 31=schnell).
* `B1/I`: Intervall des Blinkens für Schaltzustand `blink1` bzw. _Position1_ (aus) beim `RC-ServoSwitch-D`
* `B1/D`: Einschaltdauer des Blinkens für Schaltzustand `blink1`  bzw. _Position2_ beim `RC-ServoSwitch-D`
* `B2/I`: Intervall des Blinkens für Schaltzustand `blink2` bzw. _Position3_ beim `RC-ServoSwitch-D`
* `B2/D`: Einschaltdauer des Blinkens für Schaltzustand `blink2` bzw. _Position4_ beim `RC-ServoSwitch-D`
* `PThu`: Der sog. PassThrough-Kanal: ein beliebiger `OpenTX`-Kanal (`1` ... `16`) kann zur Weiterleitung an den Ausgang des Schaltmoduls ausgewählt werden. 
Beim `RC-ServoSwitch` kann bei einem Wert von `1` mit Hilfe des Kanals `1` des Senders (fest zugeordnet) die _Position1_ gelernt werden, beim einem Wert `2` 
die _Position2_ u.s.w. Bei einem Wert von `11` wird der _Follow_-Mode als _Copy Positions_, bei einem Wert von `12` wird der _Follow_-Mode als `Own-Positions` eingestellt, der Wert von `10` stellt wieder den normalen Bewegungsmodus ein.
* `Min`: (unbenutzt / nicht vorhanden in neueren Versionen)
* `Max`: (unbenutzt / nicht vorhanden in neueren Versionen)

Es existiert eine zusätzliche Seite (am Ende) mit modul-globalen Einstellungen:

* `Learn Ch/Adr`:  _Anlernen_ der Moduladresse und des Übertragungskanals (s.a. <<learn>>)
* `TMpx`: Zeitmultiplex-Verfahren für den Ausgang mit der jeweilige Adresse (nur bei `RC-MultiAdapter-DA`, s.u.)
* `TMode`: 
..  Anpassung der Impulslänge für ein/aus im Zeitmultiplex-Verfahren für den Ausgang mit der jeweilige Adresse (nur bei `RC-MultiAdapter-DA`, s.a. <<adapt>>)
..  Testmuster (nur bei `RC-MultiSwitch-D`)
* `OMpx`: Länge des Synchron-Impulses für analoge Schaltmodul (nur bei `RC-MultiAdapter-DA`), damit lassen sich Toleranzen der analogen Schaltmodule ausgleichen (s.a. <<adapt>>).
* `Test`: Verschiedene Test-Modi (nur zur Funktionsüberprüfung des Moduls).

Bei der Einstellung des Zeitmultiplexverfahrens gelten folgende Zuordnungen von eingestelltem Wert und Verfahren:

* Wert 0 -> Graupner-8K
* Wert 1 -> Graupner-4K
* Wert 2 -> Robbe
* Wert 3 -> CP-Elektronik 8-Ausgänge
* Wert 4 -> CP-Elektronik 16-Ausgänge
* Wert 5 -> unbenutzt
* alle anderen Werte -> Graupner-8K

.Einrichten von sog. Multi-Prop-Modulen
[TIP]
--
Zum Betrieb von sog. Multi-Prop-Modulen ist es nötig, für die _gewünschten_ Kanäle Zuordnungen zu den `OpenTx`-Kanälen zu machen. Dies 
macht man mit dem `PassThru`-Parameter (s.o.).

Konfiguriert man _keinen_ `PassThru`-Kanal, so bewegt sich das dort angeschlossene Servo von _Endstellung_1_ über _Neutral_ zu _Endstellung_2_.
--

[[adapt]]
.`RC_MultiAdapater-DA`: Anpassungen an Toleranzen der analogen Schaltmodule
[TIP]
--
Es kommt vor, dass die analogen Schaltmodule mit einem sporadischen _Flackern_ der Ausgänge reagieren. Um dies zu kompensieren, dient der Parameter `Ompx`.
Neutrale Werte sind bei `Ibus` etwa 16, bei `SBus` etwa 8. Es kann sein, dass dieser Wert beim Auftreten des Flackern vergrößert werden muss.

Seltener kommt es vor, das zwar _kein_ Flackern auftritt, jedoch die _ein_-Positionen nicht immer erkannt werden. _nur_ in diesem Fall den Parameter 
`TMode` verändern.
--

[[adaptcp]]
.`RC_MultiAdapater-DA`: Anpassungen an CP-Elektronik Schaltmodule
[TIP]
--
Kanalzählung von 8 zu 1 (anders herum) bzw. 16 zu 1

LED des CP-Moduls muss _erlöschen_ -> gültiges Signal

Falls kein gültiges Signal erkannt wird:

* `OMpx`  <= 8`
* `TMode` <= 8

--

=== Physische Schalter und die Schaltzustände

In den Konfigurationsdateien für die Modelle, also etwa `MODELS/ABC.lua` für das Modell mit dem Namen `ABC` kann man den einzelnen Funktionen
phys. Schalter mit Hilfe ihrer _Namen_ zuweisen. Die Namen sind `sa`, `sb`, ... `se`, `sg` der 3-Positionen-Schalter. Damit kann man die ersten 
drei Zustände `aus`, `ein` und `blink1` erreichen.

==== ShortCuts / Abkürzungen

Wird _einer_ Funktionen _genau_ ein Schalter zugewiesen, so ist dieser Schalter ein _ShortCut_ für die ersten drei Zustände dieser Funktion. 

==== Overlays / Ebenenumschaltung

Werden _mehreren_ Funktionen _derselbe_ Schalter zugewiesen, so ist dieser Schalter ein _Overlay_ für die ersten drei 
Zustände dieser Funktionen. Dies bedeutet, dass dieses phys. Schalter nur dann aktiv sind, wenn das entsprechende 
Menu _ausgwählt_ ist (etwa durch `6pos`). 

== Einbau 

=== IBus oder SBus

==== Ab Firmware `V21`

Ab dieser _Firmware_-Version werden die Module auf eine _automatische_ Erkennung des Bus-Systems (`IBus`, `SBus`, `SBus` (invertiert) ) umgestellt. Auch 
ein _Inverter_ bei `Sbus` (s.a. <<inverter>>) _entfällt_.

[options="header"]
|====
| Version | Modul mit _Bus_-Erkennung
| >= V21   | `RC-MultiAdapter-DA`
|====

==== Bevor Firmware `V21` 

Die Module sind fest programmiert für `IBus` oder `SBus`-Eingangssignale. 

*Zusätzlich* braucht man für den Anschluß an ein `SBus` noch einen *Signal-Inverter*. Dieser muss in die Zuleitung vom `SBus` zum 
`RC MultiSwitch-D` oder `RC MultiAdapter-DA` eingeschleift werden (wie ein Verlängerungskabel).

[[inverter]]
.Einfacher Inverter mit einem Kleinsignal-MosFet
image::inverter.png[pdfwidth=50%,align="center"]

Ein Inverter wie in <<inverter>> kann einfach in ein Servokabel eingebaut werden.

.SBus ist nicht gleich SBus
[CAUTION]
--
Leider ist der _Werte-Bereich_, in denen die einzelnen Kanäle eines SBus-Signal skaliert werden, nicht wohl definiert, und 
einige Hersteller legen unterschiedliche Grenzen des Wertebereiches fest. Dies führt zu Problemen!

Als Referenz wurde der Wertebereich eines `FrSky R8X`- Empfängers zu Grunde gelegt.

Abweichend hiervon sind:

* `FlySky FS-iA4B` in der Einstellung `SBus,PWM`
* `FlySky FS-iA6B` in der Einstellung `SBus,PWM`
* `FlySky FS-iA10B` in der Einstellung `SBus,PWM`
--

Mit den o.g. Empfängern funktioniert das Modul derzeit nur im Modus `IBus,PWM` oder `IBus,PPM`

=== Anschluß an den Akku

Achten Sie auf richtige Polung.

=== Schutz 

Um das Modul gegen Feuchtigkeit zu schützen, empfielt es sich, das Modul 
mit Polyurethan-Lack-Schutzlack (z.B. Kontakt 70) zu überziehen. Bitte kleben Sie jedoch voher den Pfostenverbinder für den Kontackt, den 
die Löt-Pads für die Anschlußkabel ab.

Ein Einschrumpfen mit Schrumpfschlauch ist möglich.

== Erste Einrichtung und Anlernen

Im Auslieferungszustand sind die `RC MultiSwitch-D` auf den Übertragungskanal `10` und die Adress `0` eingestellt. 
Damit kann an einem Übertragungskanal natürlich nur ein Modul betrieben werden (jedes Modul _muss_ eine eigene eindeutige Adresse haben).

[[learn]]
=== Kanal und Adresse

Das _Anlernen_ von _Kanal_ und _Adresse_ geschieht in _einem_ Schritt. Dazu _muss_ das zu konfigurierende `RC MultiSwitch-D` 
_allein_ am betreffenden `IBus` oder `SBus` hängen. Weiterhin sollten außer dem zu konfiguriereden Übertragungskanal 
für die `RC MultiSwitch-D`-Module alle anderen Übertragungskanäle im Sender _dekativiert_ werden (keine _Mischer_ aktivieren).

.Spezielles Modell für das Anlernen der Module
[TIP]
--
Um den Anlernvorgang zu erleichtern, kann man sich ein spezielles _Modell_ nur für das Anlernen einrichten. 
Dieses Modell wird _niemals_ für die Steuerung eines realen Modells verwendet.
Bei diesem Modell sind _alle_ Übertragungskanäle bis auf den Kanal für die digitalen Schaltmodule deaktiviert 
(keine Mischer).
--

.Anschluß des Moduls zum Anlernen
[CAUTION]
--
* Dass anzulernende Modul _muss allein_ am IBus/SBus angeschlossen sein.
* An den Ausgängen des Moduls dürfen keine Verbraucher angeschlossen sein.
--

.Ablauf:

. Sender und Empfänger sowie Schaltmodule aus.
. Ein `RC MultiSwitch-D` an den `IBus` oder `SBus` anschließen.
. Die Mischer-Skripte `encsbm.lua`, `encxjt.lua` oder `encib.lua` für den gewünschten Übertragungskanal einrichten (s.o.).
. Sender einschalten.
. Konfigurationsmenu auswählen
. Im Konfigurationsmenu auf der _letzten_ Seite (modul-spezifische Einstellungen) den Parameter `Learn Ch/Adr` selektieren. Oben rechts muss dann 
der Wert dunkel unterlegt sein. Mit dem Potentiometer `S1` die _Adresse_ einstellen (Wert `1` ... `8` bedeutet Adresse `1` ... `8`).
. Empfänger einschalten
. das zu konfigurierende `RC MultiSwitch-D` einschalten, sofern nicht über BEC versorgt (neue Version) (`RC-MultiAdapter-DA` wird vom Empfänger versorgt).
.. `RC-MultiAdapter-DA` und `RC-ServoSwitch-D`: die Kontroll-LED leuchtet für 3 Sekunden, anschließend blinkt sie `1` ... `8` mal, je nach eingestellter Adresse. Sollte dies nicht passieren, 
so wurde der Übertragungskanal nicht gefunden.
.. `RC-MultiSwitch-D`: entsprechend der gelernten Adresse leuchtet ein Kanal auf. 
. nach ca. 2 weiteren Sekunden das `RC MultiSwitch-D` ausschalten
. Für weitere `RC MultiSwitch-D`-Module die nä. Adresse selektieren
. das nä. `RC MultiSwitch-D` anschließen und einschalten
. ...

.Kontrolle:

Nach dem Anlernen von Kanal und Adresse kann man auch sofort ins Bedien-Menu wechseln, dort die Seite für die Modul-Adresse 
auswählen und kontrollieren, ob sich das Schaltmodul ansprechen lässt. Andernfalls ist der Anlernvorgang zu wiederholen.

=== Adressen beim `RC MultiAdapter-DA`

Weil der `RC MultiAdapter-DA` insgesamt 5 alte Schaltmodule ansteuern kann, belegt er auch 5 
_unmittelbar aufeinanderfolgende_ Adressen.

Damit gilt das folgende Schema für die Zuordnung von Adressen zu den Ausgängen des `RC MultiAdapter-DA` und den daran angeschlossenen Schaltmodulen:

* erlernte Adresse `A` -> Ausgang `S2`
* Adresse `(A+1)` -> Ausgang `S1`
* Adresse `(A+2)` -> Ausgang `Q0`
* Adresse `(A+3)` -> Ausgang `S3`
* Adresse `(A+4)` -> Ausgang `S4`

== Funktion

=== Bedienung der Schaltunktionen

Mit dem Widget `WM MultiSwitch` können Schaltfunktionen ausgewählt werden. 

Dies geschieht im Normalfall über `T5 - Up` und `T5 - Down` zur Navigation durch die Zeilen und Spalten des Menus. Mit `T6 - Up` kann eine Funktion ausgewählt
(selektiert) werden. 

Sind die beiden Schieber `LS` und `RS` vorhanden und erkannt worden, so kann mit `LS` in den Zeilen gescrollt werden und mit 
`RS` in den Spalten des Menus.

Sind im Menu _mehr_ als eine Seite (also _mehr_ als 8 Schaltfunktionen bzw. mehr als ein Schaltmodul) enthalten. so kommt man auf die nächste Seite, indem man auf
den Eintrag _ganz unten rechts_ navigiert und dann noch einmal nach unten navigiert (`T5 - Down`). Entsprechend auf die vorige Seite.

Wird der 6-Positionenschalter `6pos` erkannt, so kann damit schnell zwischen den ersten sechs Menu-Seiten navigiert werden.

.ShortCuts

Haben Schaltfunktionen _ShortCuts_ zugeordnet (_ein_ phys. Schalter: `sa` ... `sh`), so können diese Funktionen und die 
_ersten drei_ Zustände mit diesem Schalter aktiviert werden. Dies gilt _unabhängig_ von der gerade angezeigten Menu-Seite. Daher der Name 
_ShortCut_ (Abkürzung). Oft benötigte Funktionen sollte also mit einem _eindeutigen_ Schalter belegt werden.

Der Name des Schalters (bspw.: `sg`) wird dann nach dem Funktionsnamen (bspw.: `Fun A`) angegeben: dann `Fun A/sg`.

.Overlays / Ebenenumschaltung 

Wurde eine Schalter _mehreren_ Funktionen zugordnet, so wird zu einem _Overlay_. Dies wird dann mit einem _zusätzlichen_ `!` nach dem Namen 
gekennzeichnet: etwa `Fun A/sb!` und `Nuf C/sb!`. Der Schalter `sb` schaltet die Zustände von `Fun A` nur dann, wenn die Menu-Seite
mit `Fun A` aktiv (sichtbar) ist. Ist die Seite mit `Nuf C` sichtbar, so schaltet der Schalter `sb` die Zustände von `Nuf C`. 

=== Konfiguration

Mit dem Widget `WM MultiSwitch Config` können Schaltfunktionen konfiguriert werden. 

Dies über `T5 - Up` und `T5 - Down` zur Navigation durch die Zeilen und Spalten des Menus. Mit `T6 - Up` kann eine Funktion ausgewählt
(selektiert) werden. 

.Keine unmittelbare Rückmeldung
[NOTE]
--
Im Gegensatz zu vielen anderen technischen Geräten, die über ein Menu-System konfiguriert werden, gibt es im Konfigurationsmenu hier nach der 
_Selektion_ und dem _Einstellen_ eine _Parameterwertes_ keine besondere _Rückmeldung_ an den Benutzer über den Erfolg oder Misserfolg! Daher ist hier 
sorgsam vorzugehen.

Wird jedoch ein `RC-MultiAdapter-DA` über das Konfigurationsmenu _angesprochen_, so leuchtet die Kontroll-LED auf, um anzuzeigen, dass ein 
Parameter des Moduls konfiguriert wird. Wechselt man wieder in das Funktionsmenu, so muss die Kontroll-LED erlischen.
--

.Delektion nach dem Einstellen eines Parameters
[TIP]
--
Als Schutz vor einem unbeabsichtigen Ändern eines Parameterwertes, sollte man folgendermaßen vorgehen:

. Zum Parameter navigieren
. Parameter selektieren (oben rechts mit die Wertanzeige _invertiert_ erscheinen).
. Parameterwert einstellen
. *Zu einem anderen Parameter navigieren (ohne ihn zu selektieren)*. Die Invertierung der Wertanzeige ist beendet.

Der letze Schritt hebt die vorige Selektion auf. Damit kann nichts mehr unbeabsichtigt verändert werden.
--

[[Betrieb]]
== Betrieb

[TIP]
Beachten Sie unbedingt die Anweisungen unter <<first>>.

[NOTE]
Die üblichen Sicherheitsvorkehrungen im Betrieb mit ferngesteuerten Modellen, insbesonder Schiffsmodellen sind einzuhalten.

[IMPORTANT]
Beachten Sie *alle* folgenden Hinweise zum Betrieb.

[CAUTION]
Eine Verwendung des Moduls in Rennbooten oder Flogmodellen ist nicht zulässig.

[CAUTION]
Das Modul darf nicht in Kontakt mit Wasser, Wasserdampf oder anderen Flässigkeiten kommen. Wasser oder Wasserdampf bzw. andere 
Flüssigkeiten können zu einem Totalausfall 
und damit zu einem Modellverlust sowie Personenschäden führen.

[CAUTION]
Das Modul verbraucht im Ruhezustand nur sehr wenig Strom. Trotzdem darf ein dauerhafter Anschluß an einen *unüberwachten* Akku nicht erfolgen.
Hier besteht Brandgefahr! Gefahr von Personenschäden!

[CAUTION]
Beim Betrieb ist die Erwärmung des Moduls zwingend zu überwachen! Eine Überhitzung kann zu einem Totalausfall und damit 
zu einem Modellverlust führen. Gefahr von Personenschäden!

[CAUTION]
Die Spannunsgversorgung ist Moduls ist im Betrieb zu überwachen. Bei Unterspannung kann das Modul abschalten oder bei gleichzeitiger 
hoher Stromaufnahme überhitzen und so zu einem Totalausfall 
und damit zu einem Modellverlust sowie Personenschäden führen

[CAUTION]
Die erforderlichen Kabelquerschnitte für die Verbindung mit dem Akku und auch mit dem elektrischen Verbraucher sind unbedingt einzuhalten. 
Hier besteht Brandgefahr. Gefahr von Personenschäden!

[CAUTION]
Beim Betrieb ist der maximale Stromdurchfluß zu begrenzen und zu überwachen. Ein zu langer und zu hoher Stromfluß kann zu einem Totalausfall 
und damit zu einem Modellverlust sowie Personenschäden führen.

[CAUTION]
Das Modul ist nicht kurzschlußfest. Ein Kurzschluß führt zu einem Totalausfall 
und damit zu einem Modellverlust sowie Personenschäden.

[CAUTION]
Der maximale Schaltstrom ist ist unbedingt einzuhalten und darf nicht überschritten werden. Ein zu hoher Schaltstrom kann zu einem Totalausfall 
und damit zu einem Modellverlust sowie Personenschäden führen.

[CAUTION]
Die Kapazitäten (Elkos, Siebelkos) am Ausgang des Moduls, etwa in Fahrtreglern (Stellern) für Motoren, 
dürfen 10.000µF nicht überschreiten. Zu hohe Kapazitäten können zu einem Totalausfall 
und damit zu einem Modellverlust sowie Personenschäden führen.

[CAUTION]
Das Modul darf keinen Vibrationen ausgesetzt werden. Treffen Sie entsprechende Vorkehrungen zu einem vibrationsgeschützten Einbau. Zu starke 
Vibrationen können zu einem Totalausfall und damit zu einem Modellverlust sowie Personenschäden führen.

[CAUTION]
Das Modul darf nur innerhalb eines Temperaturbereiches von -10°C bis +55°C betrieben werden. Ein Betrieb außerhalb dieses 
Bereiches kann zu einem Totalausfall und damit zu einem Modellverlust sowie Personenschäden führen.

== Fehlersuche und Tests

Weder der `RC-MultiSwitch-D` noch der `RC-MultiAdapter-DA` können dem Benutzer direkt Rückmeldung über ihre Einstellungen geben. Daher ist die 
Fehlersuche auf ein klar strukturiertes Vorgehen angewiesen.

Die häufigsten Fehlerquellen sind:

* Unterscheidung `IBus` / `SBus` 
** Unterscheidung `SBus` mit `XJT`-Sendemodul oder MPM-Sendemodul.
* `SBus`-Inverter
* Addressvergabe

=== Checkliste `IBus`

`IBus` ist ein Bus-System der Fa. _FlySky_ und kommt daher nur bei _FlySky_-Empfängern vor.

.*Richtiger `IBus`-Ausgang*?

An den Empfängern gibt es _zwei_ `IBus`-Ausgänger: `IBus`-Servo und `IBus`-Sensor. 
Es muss der `IBus`-Servo Ausgang gewählt werden.

.Aufbau mit einem Empfänger, der `IBus`-Servo liefert
[ditaa]
....

 +----------------+      +---------------------+
 |                |      |                     |
 | Empfänger IBus | -+-> | RC_MultiSwitch_D    | --> Verbraucher
 |                |  |   |                     |
 +----------------+  |   +---------------------+
                     |  
                     |   +---------------------+
                     |   |                     |
                     +-> | RC_MultiAdapater_DA | --> analoge Schaltmodule
                     |   |                     |
                     |   +---------------------+
                     |
                     |   +---------------------+
                     |   |                     |
                     +-> | RC_ServoSwitch_D    | --> Servo
                     |   |                     |
                         +---------------------+
                     
                     ^
                     :
                     :
                     :
                IBus-Servo
....

.*Korrekte Verkabelung*?

Anders als beim `IBus`-Sensor werden beim `IBus`-Servo - wie bei einem Bus-System üblich - alle Teilnehmer _parallel_ geschaltet.

Beim `RC-MultiAdapter-DA` existieren keine _Kontroll-LEDs_. Man also zur Funktionskontrolle ein analoge Schaltmodul anschließen. Und auch hier an dessen
Ausgänge z.B. Leuchtdioden zur Kontrolle anschließen sowie eine Spannungsversorgung.

.*Richtige Konfiguration Multi-Protokol-HF-Modul*?

Das _MPM_ im Sender muss auf `MULTI FlySky_2A PWM,IBUS` eingestellt sein.

.*Richtige Konfiguration des Models*?

In den Konfigurationsdateien muss _ebenfalls_ der richtige Bus-Typ ausgewählt werden. Dies geschieht am Anfang der Konfigurationsdatei.

.Ausschnitt aus der Datei `swstd.lua`, `swstdm.lua` oder `swstds.lua`
[source,lua,linenums]
----
local name = "Default";

local gVariable = 5;

local useSbus = 0; -- only 4 states, only 16 parameter values <1>

local gstates1 = {"aus", "ein", "blink1", "blink2"};
local gstates2 = {"aus", "ein 1", "ein 2"};----
----
<1> Richtige Einstellung für `IBus` ist: `useSbus = 0`

Achten Sie auf die korrekte Auswahl der Konfigurationsdatei (ggf. Name des Modells): der verwendete Name wird am Fuß des _Widget_ angezeigt.

.*Korrektes Mixer-Script*?

Es muss das Script `encib` eingerichtet sein.

=== Checkliste `SBus`

`SBus` wird von vielen Herstellen als Bus-System verwendet, so auch von der Fa. _FrSky_.

.*Richtiger `SBus`-Ausgang*?

Viele `SBus`-fähige Empfänger haben auch eine Telemetrie-Möglichkeit. Der dafür verwendete Bus heißt `S.Port` und ist anders am Empfänger gekennzeichnet.

.Aufbau mit einem Empfänger, der `SBus`-Servo liefert
[ditaa]
....

 +----------------+                              +---------------------+
 |                |      +---------------+       |                     |
 | Empfänger SBus |--+-> | SBus-Inverter |  -+-> | RC_MultiSwitch_D    | --> Verbraucher
 |                |  |   +---------------+   |   |                     |
 +----------------+  |                       |   +---------------------+
                     |                       |  
                     |                       |   +---------------------+
                     |                       |   |                     |
                     |                       +-> | RC_MultiAdapater_DA | --> analoge Schaltmodule
                     |                       |   |                     |
                     |                       |   +---------------------+
                     |                       |  
                     |                       |   +---------------------+
                     |                       +-> |                     |
                     |                           | RC_ServoSwitch_D    | --> Servos
                     |                           |                     |
                     |                           +---------------------+
                     |
                     |
                     |       +-------------+
                     +-----> | andere SBus |
                             | Teilnehmer  |
                             +-------------+
                
....

.*Korrekte Verkabelung*?

Für `RC-MultiSwitch-D` und `RC-MultiAdapter-DA` benötigt man einen `SBus`-Inverter. _Andere_ `SBus`-Teilnehmer sind nach wie vor _vor_ 
dem Inverter anzuschließen.

Beim `RC-MultiAdapter-DA` existieren keine _Kontroll-LEDs_. Man also zur Funktionskontrolle ein analoge Schaltmodul anschließen. Und auch hier an dessen
Ausgänge z.B. Leuchtdioden zur Kontrolle anschließen sowie eine Spannungsversorgung.

.*Richtige Konfiguration des Models*?

In den Konfigurationsdateien muss _ebenfalls_ der richtige Bus-Typ ausgewählt werden. Dies geschieht am Anfang der Konfigurationsdatei.

.Ausschnitt aus der Datei `swstd.lua`, `swstdm.lua` oder `swstds.lua`
[source,lua,linenums]
----
local name = "Default";

local gVariable = 5;

local useSbus = 1; -- only 4 states, only 16 parameter values <1>

local gstates1 = {"aus", "ein", "blink1", "blink2"};
local gstates2 = {"aus", "ein 1", "ein 2"};----
----
<1> Richtige Einstellung für `SBus` ist: `useSbus = 1`

Achten Sie auf die korrekte Auswahl der Konfigurationsdatei (ggf. Name des Modells): der verwendete Name wird am Fuß des _Widget_ angezeigt.

.*Korrektes Mixer-Script*?

Je nach verwendetem HF-Modul im Sender ist eine Unterscheidung zu treffen:

[horizontal]

`XJT`-Modul:: es muss das Script `encxjt` eingerichtet sein.

`MPM`-Modul:: es muss das Script `encsbm` eingerichtet sein.

=== Gelegentliches Flackern oder Kanalfehlfunktion bei `RC-MultiAdapter-DA`

Manchmal kommt es zu Toleranzen bei den alten, analogen Schaltmodulen. Bitte nach <<adapt>> verfahren.

== Anerkennungen

Die folgenden Personen haben durch ihr unermüdliches Testen, Bereitstellung von Sender und Empfängern, und ihr konstruktives Feedback wesentlich zum Erfolg des Projektes beigetragen:

* Stefan Becker
* Jürgen Jahn
* Axel Müller
* Johannes Unrath

== Kontakt

Anfragen: wilhelm.wm.meier@googlemail.com
